<div class="header bg-gradient-danger pb-8 pt-5 pt-md-8"></div>

<div class="container-fluid mt--7">
  <div class="row mb-5">
    <div class="col">
      <div class="card bg-default shadow">
        <div class="card-header bg-transparent border-0">
          <h3 class="text-white mb-0">My Loans</h3>
        </div>
        <div class="table-responsive">
          <table class="table align-items-center table-dark table-flush">
            <thead class="thead-dark">
              <tr>
                <th scope="col">Date Issued</th>
                <th scope="col">Amount</th>
                <th scope="col">% Paid</th>
                <th scope="col">Status</th>
                <!-- <th scope="col" *ngIf="authService.isCurrentUserAdmin()">Action</th> -->
                <th scope="col">Action</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let loan of myLoans">
                <td *ngIf="!loan.approved">pending</td>
                <td *ngIf="loan.approved">{{ loan.dateIssued }}</td>
                <td>Ksh. {{ loan.amount }}</td>
                <td>
                  <div class="d-flex align-items-center">
                    <span class="mr-2">{{ getPercentagePaid(loan.amountPaidSoFar, loan.amountPayable) }}%</span>
                    <div>
                      <div class="progress">
                        <div [class.bg-danger]="getPercentagePaid(loan.amountPaidSoFar, loan.amountPayable) <= 49"
                        [class.bg-success]="getPercentagePaid(loan.amountPaidSoFar, loan.amountPayable) >= 75"
                        [class.bg-warning]="getPercentagePaid(loan.amountPaidSoFar, loan.amountPayable) >= 50 && getPercentagePaid(loan.amountPaidSoFar, loan.amountPayable) <= 74 "
                        class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" 
                        [ngStyle]="{'width': getPercentagePaid(loan.amountPaidSoFar, loan.amountPayable) + '%'}"></div>
                      </div>
                    </div>
                  </div>
                </td>
                <td>
                  <span class="badge badge-dot mr-4">
                    <i [class]="getLoanStatus(loan.amountPaidSoFar, loan.amountPayable, loan.approved, true)"></i> {{ getLoanStatus(loan.amountPaidSoFar, loan.amountPayable, loan.approved) }}
                  </span>
                </td>
              </tr>
              <tr>
                <td>23/04/18</td>
                <td>Ksh. 60,000</td>
                <td>
                  <div class="d-flex align-items-center">
                    <span class="mr-2">60%</span>
                    <div>
                      <div class="progress">
                        <div class="progress-bar bg-warning" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;"></div>
                      </div>
                    </div>
                  </div>
                </td>
                <td>
                  <span class="badge badge-dot mr-4">
                    <i class="bg-warning"></i> half-paid
                  </span>
                </td>
                <td class="text-right">
                  <div ngbDropdown placement="bottom-right">
                    <a class="btn btn-sm btn-icon-only text-light"  ngbDropdownToggle>
                      <i class="fas fa-ellipsis-v"></i>
                    </a>
                    <div ngbDropdownMenu class=" dropdown-menu-right dropdown-menu-arrow">
                      <a class="dropdown-item" href="javascript:void(0)">Action</a>
                      <a class="dropdown-item" href="javascript:void(0)">Another action</a>
                      <a class="dropdown-item" href="javascript:void(0)">Something else here</a>
                    </div>
                  </div>
                </td>
              </tr>
              <tr>
                <td>23/04/18</td>
                <td>Ksh. 20,000</td>
                <td>
                  <div class="d-flex align-items-center">
                    <span class="mr-2">100%</span>
                    <div>
                      <div class="progress">
                        <div class="progress-bar bg-success" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%;"></div>
                      </div>
                    </div>
                  </div>
                </td>
                <td>
                  <span class="badge badge-dot mr-4">
                    <i class="bg-success"></i> paid
                  </span>
                </td>
                <td class="text-right">
                  <div ngbDropdown placement="bottom-right">
                    <a class="btn btn-sm btn-icon-only text-light"  ngbDropdownToggle>
                      <i class="fas fa-ellipsis-v"></i>
                    </a>
                    <div ngbDropdownMenu class=" dropdown-menu-right dropdown-menu-arrow">
                      <a class="dropdown-item" href="javascript:void(0)">Action</a>
                      <a class="dropdown-item" href="javascript:void(0)">Another action</a>
                      <a class="dropdown-item" href="javascript:void(0)">Something else here</a>
                    </div>
                  </div>
                </td>
              </tr>
              <!-- <tr>
                <th scope="row">3</th>
                <td>23/04/18</td>
                <td>Ksh. 20,000</td>
                <td>09/11/18</td>
                <td>
                  <div class="d-flex align-items-center">
                    <span class="mr-2">100%</span>
                    <div>
                      <div class="progress">
                        <div class="progress-bar bg-success" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%;"></div>
                      </div>
                    </div>
                  </div>
                </td>
                <td>
                  <span class="badge badge-dot mr-4">
                    <i class="bg-success"></i> paid
                  </span>
                </td>
                <td class="text-right">
                  <div ngbDropdown placement="bottom-right">
                    <a class="btn btn-sm btn-icon-only text-light"  ngbDropdownToggle>
                      <i class="fas fa-ellipsis-v"></i>
                    </a>
                    <div ngbDropdownMenu class=" dropdown-menu-right dropdown-menu-arrow">
                      <a class="dropdown-item" href="javascript:void(0)">Action</a>
                      <a class="dropdown-item" href="javascript:void(0)">Another action</a>
                      <a class="dropdown-item" href="javascript:void(0)">Something else here</a>
                    </div>
                  </div>
                </td>
              </tr> -->
            </tbody>
          </table>
        </div>
        <div class="card-footer bg-default py-4">
          <nav aria-label="...">
            <ul class="pagination justify-content-end mb-0">
              <li class="page-item disabled">
                <a class="page-link" href="javascript:void(0)" tabindex="-1">
                  <i class="fas fa-angle-left"></i>
                  <span class="sr-only">Previous</span>
                </a>
              </li>
              <li class="page-item active">
                <a class="page-link" href="javascript:void(0)">1</a>
              </li>
              <li class="page-item">
                <a class="page-link" href="javascript:void(0)">2 <span class="sr-only">(current)</span></a>
              </li>
              <li class="page-item"><a class="page-link" href="javascript:void(0)">3</a></li>
              <li class="page-item">
                <a class="page-link" href="javascript:void(0)">
                  <i class="fas fa-angle-right"></i>
                  <span class="sr-only">Next</span>
                </a>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </div>
  
  <div class="row">
    <div class="col-xl-6 mb-5">
      <div class="card wp-card shadow mb-4">
        <div class="card-header bg-transparent">
          <div class="row align-items-center">
            <div class="col">
              <h6 class="text-uppercase ls-1 mb-1">member</h6>
              <h2 class="mb-0">Request Loan</h2>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-lg-6">
              <div class="form-group">
                <label class="form-control-label" for="input-request-loan-amount">Enter amount</label>
                <input type="number" [(ngModel)]="loanRequestAmount" name="input-request-loan-amount" id="input-request-loan-amount" class="form-control form-control-alternative" placeholder="Amount" value="1000">
              </div>
            </div>
            <div class="col-lg-6">
              <div class="form-group">
                <label for="" class="text-default">.</label>
                <input type="button" (click)="requestLoan()" class="btn btn-success form-control form-control-alternative" value="Request">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-6 mb-5">
      <div class="card bg-light wp-card shadow">
        <div class="card-header bg-transparent">
          <div class="row align-items-center">
            <div class="col">
              <h6 class="text-uppercase ls-1 mb-1">member</h6>
              <h2 class="mb-0">Pay Loan</h2>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-lg-6">
              <div class="form-group">
                <label class="form-control-label" for="input-first-name">Select Loan</label>
                <div class="ddown">
                  <button class="ddown-toggle btn form-control" (click)="toggleDropdown('ddown-content-loan')">{{ selectedLoan }}</button>
                  <div class="ddown-content ddown-content-loan" style="width: 100%;">
                    <p *ngFor="let myLoan of myLoansDropdown" (click)="selectLoan(myLoan)">Ksh {{ myLoan.amount }}</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-lg-6">
              <div class="form-group">
                <label class="form-control-label" for="input-repay-loan-amount">Amount to Pay</label>
                <input type="number" [(ngModel)]="loanRepaymentAmount" name="input-repay-loan-amount" id="input-repay-loan-amount" class="form-control form-control-alternative" placeholder="Amount" value="500">
              </div>
            </div>
            <div class="offset-6 col-lg-6">
              <div class="form-group">
                <label for="" class="text-default">.</label>
                <input type="button" (click)="repayLoan()" class="btn btn-success form-control form-control-alternative" value="Pay">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- <div *ngIf="authService.isCurrentUserAdmin()"> -->
  <div>
    <div class="row mt-6">
      <div class="col col-xl-12">
        <h1>Admin Tools</h1>
        <hr>
      </div>
    </div>
  
    <div class="row">
      <div class="col col-xl-12">
        <div class="card bg-light shadow">
          <div class="card-header bg-transparent border-0">
            <h3 class="text-default mb-0">All Loans</h3>
          </div>
          <div class="table-responsive">
            <table class="table align-items-center table-light table-flush">
              <thead class="thead-light">
                <tr>
                  <th scope="col">Receipient</th>
                  <th scope="col">Amount</th>
                  <th scope="col">Date Issued</th>
                  <th scope="col">Date Due</th>
                  <th scope="col">Payment Status</th>
                  <th scope="col">Action</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let loan of allLoans">
                  <td>{{ loan.receipient }}</td>
                  <td>Ksh. {{ loan.amount }}</td>
                  <td *ngIf="!loan.approved">pending</td>
                  <td *ngIf="loan.approved">{{ loan.dateIssued }}</td>
                  <td *ngIf="!loan.approved">pending</td>
                  <td *ngIf="loan.approved">{{ loan.dateDue }}</td>
                  <td>
                    <span class="badge badge-dot mr-4">
                      <i [class]="getLoanStatus(loan.amountPaidSoFar, loan.amountPayable, loan.approved, true)"></i> {{ getLoanStatus(loan.amountPaidSoFar, loan.amountPayable, loan.approved) }}
                    </span>
                  </td>
                  <td *ngIf="!loan.approved && authService.currentUserIsAdmin">
                    <button (click)="evaluateLoan(loan, 'approved')" class="btn btn-sm btn-success">approve</button>
                    <button (click)="evaluateLoan(loan, 'rejected')" class="btn btn-sm btn-danger">reject</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="card-footer bg-light py-4">
            <nav aria-label="...">
              <ul class="pagination justify-content-end mb-0">
                <li class="page-item disabled">
                  <a class="page-link" href="javascript:void(0)" tabindex="-1">
                    <i class="fas fa-angle-left"></i>
                    <span class="sr-only">Previous</span>
                  </a>
                </li>
                <li class="page-item active">
                  <a class="page-link" href="javascript:void(0)">1</a>
                </li>
                <li class="page-item">
                  <a class="page-link" href="javascript:void(0)">2 <span class="sr-only">(current)</span></a>
                </li>
                <li class="page-item"><a class="page-link" href="javascript:void(0)">3</a></li>
                <li class="page-item">
                  <a class="page-link" href="javascript:void(0)">
                    <i class="fas fa-angle-right"></i>
                    <span class="sr-only">Next</span>
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </div>
    </div>
  
    <div class="row mt-5">
      <div class="col-xl-6 mb-5">
        <div class="card shadow wp-card">
          <div class="card-header bg-transparent">
            <div class="row align-items-center">
              <div class="col">
                <h6 class="text-uppercase ls-1 mb-1">admin</h6>
                <h2 class="mb-0">Add Existing Loan</h2>
              </div>
            </div>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-lg-12">
                <div class="form-group">
                  <label class="form-control-label" for="dropdown-existing-loan-receipient">Receipient</label>
                  <div class="ddown">
                    <button class="ddown-toggle btn form-control" (click)="toggleDropdown('ddown-content-name-loan')" name="dropdown-existing-loan-receipient">{{ selectedLoanee }}</button>
                    <div class="ddown-content ddown-content-name-existing-loan" style="width: 100%;">
                      <p *ngFor="let loanee of membersNamesList" (click)="selectExistingLoanReceipient(loanee)">{{ loanee }}</p>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-lg-6">
                <div class="form-group">
                  <label class="form-control-label" for="input-existing-loan-amount">Loan Amount</label>
                  <input type="number" name="input-existing-loan-amount" id="input-existing-loan-amount" class="form-control form-control-alternative" placeholder="Loan Amount" value="1000">
                </div>
              </div>
              <div class="col-lg-6">
                <div class="form-group">
                  <label class="form-control-label" for="input-existing-loan-rate">Interest Rate</label>
                  <input type="text" name="input-existing-loan-rate" id="input-existing-loan-rate" class="form-control form-control-alternative" placeholder="Rate" value="5%">
                </div>
              </div>
              <div class="col-lg-12">
                <div class="form-group">
                  <label class="form-control-label" for="input-existing-loan-issue-date">Date Issued</label>
                  <input type="date" name="input-existing-loan-issue-date" id="input-existing-loan-issue-date" class="form-control form-control-alternative">
                </div>
              </div>
              <div class="col-lg-12">
                <div class="form-group">
                  <label class="form-control-label" for="input-existing-loan-due-date">Due Date</label>
                  <input type="date" name="input-existing-loan-due-date" id="input-existing-loan-due-date" class="form-control form-control-alternative">
                </div>
              </div>
              <div class="offset-6 col-lg-6">
                <div class="form-group">
                  <input type="button" (click)="addExistingLoan()" class="btn btn-primary form-control form-control-alternative" value="Add Existing Loan">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
